-- PUBLISHER TABLE

CREATE TABLE PUBLISHER
(PUBNAME VARCHAR(20) PRIMARY KEY,
ADDRESS VARCHAR(20),
PHONE INT);

-- BOOK TABLE

CREATE TABLE BOOK
(BID INT PRIMARY KEY,
TITLE VARCHAR(20),
PUBNAME VARCHAR(20) REFERENCES PUBLISHER (PUBNAME) ON DELETE CASCADE,
PUBYEAR VARCHAR(20));


-- BOOK AUTHOR TABLE

CREATE TABLE BOOK_AUTHORS
(BID INTEGER REFERENCES BOOK (BID),
ANAME VARCHAR(20),
PRIMARY KEY (BID, ANAME));

-- LIBRARY PROGRAMME

CREATE TABLE LIBRARY_PROGRAMME
(PID INT PRIMARY KEY,
PNAME VARCHAR(50),
ADDRESS VARCHAR(50));

-- BOOK COPIES TABLE

CREATE TABLE BOOK_COPIES
(BID INTEGER REFERENCES BOOK (BID) ON DELETE CASCADE,
PID INTEGER REFERENCES LIBRARY_PROGRAMME (PID) ON DELETE CASCADE,
NOOFCOPIES INTEGER,
PRIMARY KEY (BID, PID));

-- BOOKLENDING TABLE

CREATE TABLE BOOKLENDING
(
BID INTEGER REFERENCES BOOK(BID) ON DELETE CASCADE,
PID INTEGER REFERENCES LIBRARY_PROGRAMME(PID) ON DELETE CASCADE,
CARDNO INTEGER,
DATEOUT DATE,
DUEDATE DATE,
PRIMARY KEY (BID,PID));


-- INSERT INTO PUBLISHER

INSERT INTO PUBLISHER VALUES('MCGRAW-HILL','BANGALORE',9191919191);
INSERT INTO PUBLISHER VALUES('PEARSON','NEWDELHI',8181818181);
INSERT INTO PUBLISHER VALUES('RANDOM HOUSE','HYDERABAD',7171717171);
INSERT INTO PUBLISHER VALUES('LIVRE','CHENNAI',6161616161);
INSERT INTO PUBLISHER VALUES('PLANETA','BANGALORE',5151515151);

-- INSERT INTO BOOK

INSERT INTO BOOK VALUES(1,'DBMS','JAN-2017','MCGRAW-HILL');
INSERT INTO BOOK VALUES(2,'ADBMS','JUN-2016','MCGRAW-HILL');
INSERT INTO BOOK VALUES(3,'CN','SEP-2016','PEARSON');
INSERT INTO BOOK VALUES(4,'CG','SEP-2015','PLANETA');
INSERT INTO BOOK VALUES(5,'OS','MAY-2016','PEARSON');

--INSERT INTO BOOK_AUTHORS 

INSERT INTO BOOK_AUTHORS VALUES(1,'NAVATHE');
INSERT INTO BOOK_AUTHORS VALUES(2,'NAVATHE');
INSERT INTO BOOK_AUTHORS VALUES(3,'TANENBAUM');
INSERT INTO BOOK_AUTHORS VALUES(4,'EDWARD ANGEL');
INSERT INTO BOOK_AUTHORS VALUES(5,'GALVIN');

--INSERT INTO LIBRARY PROGRAMME

INSERT INTO LIBRARY_PROGRAMME VALUES(10,'VADGAON','BELGAUM');
INSERT INTO LIBRARY_PROGRAMME VALUES(11,'ANGOL','BELGAUM');
INSERT INTO LIBRARY_PROGRAMME VALUES(12,'ANAND NAGAR','BELGAUM');
INSERT INTO LIBRARY_PROGRAMME VALUES(13,'DOMBIVILI','MUMBAI');
INSERT INTO LIBRARY_PROGRAMME VALUES(14,'MULSHI','PUNE');

--INSERT INTO BOOK COPIES

INSERT INTO BOOK_COPIES VALUES(1,10,10);
INSERT INTO BOOK_COPIES VALUES(1,11,5);
INSERT INTO BOOK_COPIES VALUES(2,12,2);
INSERT INTO BOOK_COPIES VALUES(2,13,5);
INSERT INTO BOOK_COPIES VALUES(3,14,7);
INSERT INTO BOOK_COPIES VALUES(5,10,1);
INSERT INTO BOOK_COPIES VALUES(4,11,3);


--INSERT INTO BOOK LENDING

INSERT INTO BOOKLENDING VALUES(1,10,101,'01-JAN-2017','01-JUN-2017');
INSERT INTO BOOKLENDING VALUES(3,14,101,'11-JAN-2017','11-MAR-2017');
INSERT INTO BOOKLENDING VALUES(2,13,101,'21-FEB-2017','21-APR-2017');
INSERT INTO BOOKLENDING VALUES(4,11,101,'15-MAR-2017','15-JUL-2017');
INSERT INTO BOOKLENDING VALUES(1,11,104,'12-APR-2017','12-MAY-2017');

--QUERIES

-- QUERY 1

SELECT B.BID, B.TITLE, B.PUBNAME, A.ANAME,C.NOOFCOPIES,L.PID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_PROGRAMME L
WHERE B.BID=A.BID
AND B.BID=C.BID
AND L.PID=C.PID;

-- QUERY 2

SELECT CARDNO
FROM BOOKLENDING
WHERE DATEOUT BETWEEN '01-MAY-2017' AND '01-JUN-2017'
GROUP BY CARDNO
HAVING COUNT(*)>3;

-- QUERY 3

DELETE FROM BOOK
WHERE BID = 3;

-- QUERY 4

CREATE VIEW MYVIEW AS
SELECT PUBYEAR
FROM BOOK;

-- QUERY 5

CREATE VIEW MYVIEW2 AS
SELECTB.BID, B.TITLE, C.NOOFCOPIES
FROM
BOOK B, BOOK_COPIES C, LIBRARY_BRANCH L
WHEREB.BID=C.BID
AND C.PID=L.PID;